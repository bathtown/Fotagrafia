<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="bathtown">
    <meta name="COPYRIGHT" content="Fotagrafia">
    <meta name="description" content="search page">
    <!-- jQuery -->
    <script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <!-- jquery-confirm -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <script src="  https://cdn.rawgit.com/imsky/holder/master/holder.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/general.css">
    <link rel="stylesheet" type="text/css" href="../css/search.css">
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
    <base target="_self">
    <title>search</title>
</head>

<body>
    <header>
        <ul>
            <li id="bar">
                <a><span class="fa fa-bars"></span></a>
                <ul id="barlist">
                    <li>
                        <a href="../html/home.html" class="home">
                            <span><span class="fa fa-home"> </span> Home</span></span></a>
                    </li>
                    <li><a href="../html/browser.html" class="browser"><span class="fa fa-cloud"></span> Browser</a>
                    </li>
                    <li><a href="../html/search.html" class="search imlooking"><span class="fa fa-search"></span>
                            Search</a></li>
                </ul>
            </li>

            <li id="logo"><a href="../html/bicycle.html"><span class="fa fa-bicycle"></span></a></li>

            <li class="account">
                <a target="_self" href="../html/login.html" class="myAccount"><span class="fa fa-child"></span>
                    Log in</a>
                <a class="my" target="_self" href="../html/login.html"><span class="fa fa-child"></span></a>
            </li>

            <li class="account">
                <a class="myAccount">My Account <span class="fa fa-angle-down"></span></a>
                <a class="my"><span class="fa fa-user"></span></a>
                <ul>
                    <li><a href="../html/upload.html"><span class="fa fa-cloud-upload"></span> Upload</a></li>
                    <li><a href="../html/myGallery.html"><span class="fa fa-photo"></span> My Gallery</a></li>
                    <li><a href="../html/myHearts.html"><span class="fa fa-heart"></span> My Hearts</a></li>
                    <li> <a id="logout"><span class="fa fa-sign-out"></span> Log out</a> </li>
                </ul>
            </li>
        </ul>
    </header>

    <main>
        <article id="search">
            <div class="filter">
                <form name="searchFilter" id="searchFilter">
                    <div>
                        <input type="radio" name="choice" id="title" value="title" checked>
                        <label for="title">Title</label>
                    </div>
                    <input type="text" id="searchText">
                    <div>
                        <input type="radio" name="choice" id="description" value="description">
                        <label for="description">Description</label>
                    </div>
                    <textarea type="texarea" id="descripText"></textarea>
                    <input type="button" id="searchButton" value="submit" />
                </form>
            </div>
            <div class="result">
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="onePic">
                    <div class="picContain">
                        <img src="" onclick="openDetail(event)" />
                    </div>
                    <div class="message">
                        <h1>The Greatest Web River</h1>
                        <p>I loved you, and I probably still do,
                            And for a while the feeling may remain...
                            But let my love no longer trouble you,
                            I do not wish to cause you any pain.
                            I loved you; and the hopelessness I knew,
                            The jealousy, the shyness - though in vain -
                            Made up a love so tender and so true
                            As may God grant you to be loved again.
                        </p>
                    </div>
                </section>
                <section class="pageNum">
                    <p>
                        &#60;<span>1</span>
                        2 3 4 5 6 ... 9 &#62;
                    </p>
                </section>
            </div>
        </article>
        <!-- extension -->
        <div class="search_extension">
            <span class="fa fa-search" onclick="showSearchBox()"></span>
        </div>
    </main>
    <footer>
        <section>
            <copyright id="copyright">Copyright Â© 2020 Fotagrafia Inc. All rights reserved.</copyright>
            <div>
                <a href="../html/privacy.html">Privacy Policy</a>
                <span>|</span>
                <a href="../html/usage.html">Terms of Use</a>
                <span>|</span>
                <a href="../html/legal.html">Legal</a>
                <span>|</span>
                <a href="../html/siteMap.html">Site Map</a>
            </div>
        </section>
    </footer>

    <script src="../js/feature.js" type="text/javascript"></script>

    <script>
        // show search result
        function searchResult() {
            document.getElementsByClassName('result')[0].style.display = 'block';
            if (document.getElementsByClassName('filter')[0]) {
                const filterAny = document.getElementsByClassName('filter')[0];
                filterAny.setAttribute('class', "filterAfter");
            }

            const width = document.body.clientWidth;
            const extension = document.getElementsByClassName('search_extension')[0];
            if (width <= 830)
                extension.style.display = 'flex';
            filterAny = document.getElementsByClassName('filterAfter')[0];
            if (filterAny.style.display = 'block' && width <= 830) {
                filterAny.style.display = 'none';
                extension.style.display = 'flex';
            } else {
                filterAny.style.display = 'block';
            }
        }
        // show search box
        function showSearchBox() {
            document.getElementsByClassName('filterAfter')[0].style.display = 'block';
            document.getElementsByClassName('search_extension')[0].style.display = 'none';
        }

        $('#searchButton').click(function () {

            // searchText
            // descripText
            if ($('#searchText').val() === '' && $('#descripText').val() === '') {
                myAlert('warning', 'please fill sth!')
                return
            }
            else {
                // console.log($('input:radio:checked').val());
                const choice = $('input:radio:checked').val()
                let text;
                // title and description
                if (choice === 'title') text = $('#searchText').val()
                else text = $('#descripText').val()

                if (text === '') {
                    myAlert('warning', 'please fill what you choiced!')
                    return
                }
                searchResult();

                $.ajax({
                    method: "GET",
                    url: "http://localhost:8080/backend/PHP/api/search.php",
                    data: { choice: choice, text: text }
                }).done((data) => {

                    // <section class="onePic">
                    //     <div class="picContain">
                    //         <img/>
                    //     </div>
                    //     <div class="message">
                    //         <h1></h1>
                    //         <p></p>
                    //     </div>
                    // </section>

                    // description: "First time using HDR with 2 stop bracketing composed in PhotoMatix Pro 4.1"
                    // id: "5"
                    // src: "6114904363.jpg"
                    // title: "Ascending Sulpher Mountain"

                    for (let index = 0; index < data.imgs.length; index++) {
                        $('img').eq(index).attr({
                            'src': `http://localhost:8080/backend/travel-images/large/${data.imgs[index].src}`,
                            'data-id': data.imgs[index].id
                        });
                        $('.message').eq(index).children('h1').eq(0).text(data.imgs[index].title);
                        $('.message').eq(index).children('p').eq(0).text(data.imgs[index].description);
                    }
                }).fail((err) => {
                    if (err.status === 0) { myAlert('error', 'Connection refused!'); return; }
                    myAlert('error', JSON.parse(err.responseText).message);
                });
            }

            $('#searchText').val('')
            $('#descripText').val('')

            ImgFitDiv(".picContain img", 16, 9);
        });

    </script>
</body>

</html>
