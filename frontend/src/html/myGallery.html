<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="bathtown">
    <meta name="COPYRIGHT" content="Fotagrafia">
    <meta name="description" content="myGallery page">
    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- jquery-confirm -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="../css/general.css">
    <link rel="stylesheet" type="text/css" href="../css/myPicture.css">
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
    <base target="_self">
    <title>myGallery</title>
    <script>
        if (sessionStorage.getItem("token") === null)
            window.location.href = "../html/login.html";
        else {
            async function checkUserAuthority() {
                await $.ajax({
                    method: "POST",
                    url: "http://localhost:8080/backend/PHP/api/token.php",
                    headers: { Authorization: sessionStorage.getItem("token") }
                })
            }
            checkUserAuthority().catch((err) => {
                if (err.status === 0) { myAlert('error', 'Connection refused!') }
                if (err.status === 401) {
                    sessionStorage.clear();
                    window.location.href = "../html/login.html";
                }
            });
        }
    </script>
</head>

<body>

    <header>
        <ul>
            <li id="bar">
                <a><span class="fa fa-bars"></span></a>
                <ul id="barlist">
                    <li>
                        <a href="../html/home.html" class="home">
                            <span><span class="fa fa-home"> </span> Home</span></span></a>
                    </li>
                    <li><a href="../html/browser.html" class="browser"><span class="fa fa-cloud"></span> Browser</a>
                    </li>
                    <li><a href="../html/search.html" class="search"><span class="fa fa-search"></span> Search</a></li>
                </ul>
            </li>

            <li id="logo"><a href="../html/bicycle.html"><span class="fa fa-bicycle"></span></a></li>

            <li class="account">
                <a target="_self" href="../html/login.html" class="myAccount"><span class="fa fa-child"></span>
                    Log in</a>
                <a class="my" target="_self" href="../html/login.html"><span class="fa fa-child"></span></a>
            </li>

            <li class="account">
                <a class="myAccount">My Account <span class="fa fa-angle-down"></span></a>
                <a class="my"><span class="fa fa-user"></span></a>
                <ul>
                    <li><a href="../html/upload.html"><span class="fa fa-cloud-upload"></span> Upload</a></li>
                    <li><a href="../html/myGallery.html" class="imlooking"><span class="fa fa-photo"></span> My
                            Gallery</a></li>
                    <li><a href="../html/myHearts.html"><span class="fa fa-heart"></span> My Hearts</a></li>
                    <li> <a id="logout"><span class="fa fa-sign-out"></span> Log out</a> </li>
                </ul>
            </li>
        </ul>
    </header>

    <main>
        <article id="myGallery">
            <header class="hinter">My Gallery</header>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="onePic">
                <div class="picContain">
                    <img src="" onclick="openDetail(event)" />
                </div>
                <div class="message">
                    <h1></h1>
                    <p></p>
                    <div>
                        <button class="modifyPic" onclick="window.open('../html/upload.html', '_self')">Modify</button>
                        <button class="delPic">Delete</button>
                    </div>
                </div>
            </section>
            <section class="pageNum">
                <p>
                    &#60;<span>1</span>
                    2 3 4 5 6 ... 9 &#62;
                </p>
            </section>
        </article>
    </main>
    <footer>
        <section>
            <copyright id="copyright">Copyright Â© 2020 Fotagrafia Inc. All rights reserved.</copyright>
            <div>
                <a href="../html/privacy.html">Privacy Policy</a>
                <span>|</span>
                <a href="../html/usage.html">Terms of Use</a>
                <span>|</span>
                <a href="../html/legal.html">Legal</a>
                <span>|</span>
                <a href="../html/siteMap.html">Site Map</a>
            </div>
        </section>
    </footer>
    <script src="../js/feature.js" type="text/javascript"></script>
    <script>

        $(function () {
            getMyGallery();
            ImgFitDiv(".picContain img", 4, 3);
        });

        function getMyGallery() {
            $.ajax({
                method: "GET",
                url: "http://localhost:8080/backend/PHP/api/myGallery.php",
                headers: { Authorization: sessionStorage.getItem("token") },
            }).done((data) => {
                imgs = data;
                // <div class="picContain">
                //     <img src=""  />
                // </div>
                // <div class="message">
                //     <h1></h1>
                //     <p></p>
                // </div>
                for (let index = 0; index < imgs.length; index++) {
                    $('img').eq(index).attr({
                        'src': `http://localhost:8080/backend/travel-images/large/${imgs[index].src}`,
                        'data-id': imgs[index].id,
                    });
                    $('.message h1').eq(index).text(imgs[index].title);
                    $('.message p').eq(index).text(imgs[index].description);
                }

                $('img').each(
                    function () {
                        if ($(this).attr('src') === '') $(this).parents('.onePic').hide()
                    }
                )
            }).fail((err) => {
                if (err.status === 0) { myAlert('error', 'Connection refused!'); return; }
                myAlert('error', JSON.parse(err.responseText).message);
            });
        }

    </script>
</body>

</html>
